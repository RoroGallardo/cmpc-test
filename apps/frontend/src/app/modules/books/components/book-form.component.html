<div class="form-container">
  <div class="form-card">
    <h1>{{ isEditMode ? 'Editar Libro' : 'Nuevo Libro' }}</h1>

    <form [formGroup]="bookForm" (ngSubmit)="onSubmit()">
      <div class="form-grid">
        <!-- Título -->
        <div class="form-group full-width">
          <label for="title">Título *</label>
          <input
            type="text"
            id="title"
            formControlName="title"
            class="form-control"
            [class.is-invalid]="bookForm.get('title')?.invalid && bookForm.get('title')?.touched"
          />
          <div class="invalid-feedback" *ngIf="bookForm.get('title')?.invalid && bookForm.get('title')?.touched">
            <div *ngIf="bookForm.get('title')?.errors?.['required']">El título es requerido</div>
            <div *ngIf="bookForm.get('title')?.errors?.['minlength']">El título debe tener al menos 3 caracteres</div>
          </div>
        </div>

        <!-- Fecha de Publicación -->
        <div class="form-group">
          <label for="publicationDate">Fecha de Publicación</label>
          <input
            type="date"
            id="publicationDate"
            formControlName="publicationDate"
            class="form-control"
            [readonly]="isEditMode"
          />
        </div>

        <!-- Autor -->
        <div class="form-group">
          <label for="authorId">Autor *</label>
          <select
            id="authorId"
            formControlName="authorId"
            class="form-control"
            [class.is-invalid]="bookForm.get('authorId')?.invalid && bookForm.get('authorId')?.touched"
          >
            <option value="">Seleccione un autor</option>
            <option *ngFor="let author of authors" [value]="author.id">{{ author.name }}</option>
          </select>
          <div class="invalid-feedback" *ngIf="bookForm.get('authorId')?.invalid && bookForm.get('authorId')?.touched">
            El autor es requerido
          </div>
        </div>

        <!-- Género -->
        <div class="form-group">
          <label for="genreId">Género *</label>
          <select
            id="genreId"
            formControlName="genreId"
            class="form-control"
            [class.is-invalid]="bookForm.get('genreId')?.invalid && bookForm.get('genreId')?.touched"
          >
            <option value="">Seleccione un género</option>
            <option *ngFor="let genre of genres" [value]="genre.id">{{ genre.name }}</option>
          </select>
          <div class="invalid-feedback" *ngIf="bookForm.get('genreId')?.invalid && bookForm.get('genreId')?.touched">
            El género es requerido
          </div>
        </div>

        <!-- Editorial -->
        <div class="form-group">
          <label for="publisherId">Editorial *</label>
          <select
            id="publisherId"
            formControlName="publisherId"
            class="form-control"
            [class.is-invalid]="bookForm.get('publisherId')?.invalid && bookForm.get('publisherId')?.touched"
          >
            <option value="">Seleccione una editorial</option>
            <option *ngFor="let publisher of publishers" [value]="publisher.id">{{ publisher.name }}</option>
          </select>
          <div class="invalid-feedback" *ngIf="bookForm.get('publisherId')?.invalid && bookForm.get('publisherId')?.touched">
            La editorial es requerida
          </div>
        </div>

        <!-- Stock -->
        <div class="form-group">
          <label for="stock">Stock *</label>
          <input
            type="number"
            id="stock"
            formControlName="stock"
            class="form-control"
            min="0"
            [class.is-invalid]="bookForm.get('stock')?.invalid && bookForm.get('stock')?.touched"
          />
          <div class="invalid-feedback" *ngIf="bookForm.get('stock')?.invalid && bookForm.get('stock')?.touched">
            <div *ngIf="bookForm.get('stock')?.errors?.['required']">El stock es requerido</div>
            <div *ngIf="bookForm.get('stock')?.errors?.['min']">El stock debe ser mayor o igual a 0</div>
          </div>
        </div>

        <!-- Precio -->
        <div class="form-group">
          <label for="price">Precio *</label>
          <input
            type="number"
            id="price"
            formControlName="price"
            class="form-control"
            min="0"
            step="0.01"
            [class.is-invalid]="bookForm.get('price')?.invalid && bookForm.get('price')?.touched"
          />
          <div class="invalid-feedback" *ngIf="bookForm.get('price')?.invalid && bookForm.get('price')?.touched">
            <div *ngIf="bookForm.get('price')?.errors?.['required']">El precio es requerido</div>
            <div *ngIf="bookForm.get('price')?.errors?.['min']">El precio debe ser mayor o igual a 0</div>
          </div>
        </div>

        <!-- Disponible -->
        <div class="form-group">
          <div class="form-check">
            <input
              type="checkbox"
              id="available"
              formControlName="available"
              class="form-check-input"
            />
            <label class="form-check-label" for="available">
              Disponible
            </label>
          </div>
        </div>

        <!-- Imagen -->
        <div class="form-group full-width">
          <label for="image">Imagen del libro</label>
          <input
            type="file"
            id="image"
            accept="image/*"
            class="form-control"
            (change)="onFileSelected($event)"
          />
          <div class="image-preview" *ngIf="imagePreview">
            <img [src]="imagePreview" alt="Preview" />
          </div>
        </div>
      </div>

      <div class="alert alert-danger" *ngIf="error">{{ error }}</div>

      <div class="form-actions">
        <button type="button" class="btn btn-secondary" (click)="cancel()">
          Cancelar
        </button>
        <button type="submit" class="btn btn-primary" [disabled]="bookForm.invalid || loading">
          <span *ngIf="!loading">{{ isEditMode ? 'Actualizar' : 'Crear' }}</span>
          <span *ngIf="loading">Guardando...</span>
        </button>
      </div>
    </form>
  </div>
</div>
